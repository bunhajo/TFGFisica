---
title: "Primeros Resultados PDM"
author: "Juan Tornero"
date: "14 de marzo de 2017"
header-include:
  - \usepackage{bbm}
output: pdf_document
---

Tenemos la disposición inicial de puntos:

```{r, echo = FALSE, fig.height=4, fig.width=8}
library(ggplot2)

df=read.delim("C:/Users/Tornero/Documents/Uni/TFGFisica/HESS_LS5039.dat", header = FALSE, sep= "")
names(df)=c("time", "data", "error")
#today=57817 05/03/2017

#Initial Plot
ggplot(df, aes(x=time, y=10^12*data, ymin=10^12*(data-error), ymax=10^12*(data+error)))+
  geom_point()+
  geom_smooth()+
  geom_errorbar()+
  annotate("text", x=c(53200, 53600), y=c(3.5,3.5), label=c("2004", "2005"), size=10)+
  xlab("MJD")+ylab(expression(paste(Delta,"F > 1 TeV [", 10^{-12},"ph. ", cm^{-2}, s^{-1},"]")))+
  theme(axis.title.x=element_text(hjust = 1))


```

Tras implementar un pequeño añgoritmo para el cálculo del estadístico $\theta=\frac{s^2}{\sigma^2}$, hemos hecho pruebas para periodos de 1 a 5 días, en intervalos de 0.001 días. Hemos hecho este cálculo repetidamente para $(N_b,N_c)=\{(50,1), (25,2), (10,10), (10,1),(5,5) \}$, donde $N_b$ es el número de divisiones del intervalo de fase $(0,1)$, y $N_c$ el número diferente de recubrientos dado $N_b$:

```{r, echo=FALSE,  fig.height=4, fig.width=8}

full_results=readRDS("Results.rds")


# Plot Stat
ggplot(full_results, aes(x=period, y=theta, colour=factor(n_result)))+
  geom_line()+
#  annotate("text", x=c(minim_period, 1.5*minim_period), y=c(0,0), label=c("Period", "Period and half"))+
  ylab(expression(theta))+
  scale_color_discrete(guide=FALSE)+
  geom_segment(aes(x=3.8, xend=4, y=0.1, yend=0.1),colour="red")+
  geom_segment(aes(x=3.8, xend=4, y=0.85, yend=0.85),colour="red")+
  geom_segment(aes(x=3.8, xend=3.8, y=0.1, yend=0.85),colour="red")+
  geom_segment(aes(x=4, xend=4, y=0.1, yend=0.85),colour="red")

```

De los cinco mínimos del estadístico obtenemos la estimación del periodo de rotación $\mu=3.9094  \pm 0.0035$ días, lo que concuerda con el valor conocido de 3.9063 días. Destacar que en el caso (50,1) y (25,25), que son además los de mayor significancia estadística, el periodo obtenido es 3.906 en ambos casos. Esta es la representación poniendo en fase los datos para el periodo $\mu = 3.9094$:

```{r, echo=FALSE, fig.height=4, fig.width=8}

b_per=readRDS("best_period.rds")

#Plot Best Period
ggplot(b_per, aes(x=time, y=data/mean(data), ymin=(data-error)/mean(data), ymax=(data+error)/mean(data)))+
  geom_point()+
  geom_smooth(se=var(b_per$data))+
  geom_errorbar()+
  xlab("Phase")+
  ylab(expression(paste(Delta,"F > 1 TeV [", 10^{-12},"ph. ", cm^{-2}, s^{-1},"]")))



```


